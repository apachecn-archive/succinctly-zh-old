## 读写性能

数据访问模式与您的查询正在进行的操作有关，也与您运行的查询数量有关，而您的行键结构也会对此产生重大影响。 HBase 是一个分布式数据库，它有能力支持读写的高并发性，但前提是你的表设计允许它。

HBase 中的单个逻辑表实际上是在存储层中分割并存储在许多部分中，称为区域。对区域中的数据的访问由 HBase Region Server 的一个实例提供，并且在生产环境中，您将在群集中运行许多 Region Server。如果正确设计表，则不同的区域服务器可以托管不同的区域，从而为并发读写该表提供高性能。

但这也取决于你的行键。表按行键分割，每个区域都有一个开始和结束行键。如果您的设计意味着您的所有行键都以相似的值开头，那么它们将不会分布在许多区域中，并且您将无法获得高并发性。

表 3 显示了访问日志表中的一些示例行键，使用了不同的结构（为了便于阅读，在管道周围添加了空格）：

| 选项 1：{期间} &#124; {systemID} &#124; {userID} | 选项 2：{systemID} &#124; {userID} &#124; {period} | 选项 3：{userID} &#124; {systemID} &#124; {period} |
| 201510 &#124; jericho &#124;戴夫 | jericho &#124;戴夫&#124; 201510 | 戴夫&#124; jericho &#124; 201510 |
| 201510 &#124; jericho &#124;埃尔顿 | jericho &#124;埃尔顿&#124; 201510 | 埃尔顿&#124; jericho &#124; 201510 |
| 201511 &#124;铁饼&#124;埃尔顿 | 铁饼&#124;埃尔顿&#124; 201511 | 埃尔顿&#124;铁饼&#124; 201511 |
| 201510 &#124; jericho &#124;弗雷德 | jericho &#124;弗雷德&#124; 201510 | 弗雷德&#124; jericho &#124; 201510 |

表 3：行密钥设计

使用选项 1，每行以相同的五个字符开头;行之间的距离非常小，因此它们可能都在同一区域。这意味着它们都将由同一个 Region Server 提供服务，如果我们同时读取和写入一组行，我们将无法平衡多个 Region Server 之间的负载，并且我们无法获得最大性能。

![](img/00010.jpeg)提示。不要将连续值（基于日期或时间戳）用作需要高性能的表的行键。有时您需要使用顺序值来支持您想要读取数据的方式，但请注意，当您这样做时，您将限制并发性能。

选项 2 更好 - 从第一个字符开始，我们有两个不同的值。在这种情况下，我们可能在一个区域中找到三行，在另一个区域中找到一行。如果我们有许多系统可以记录访问权限，并且 ID 大不相同，那么我们可以拥有数十个区​​域，并支持高级别的并发读/写访问，并在多个区域服务器之间实现平衡。

如果我们需要最高性能，选项 3 是最好的。我们可能拥有比系统更多的用户，因此用户 ID 的超集将具有数百或数千个值，并且它们之间可能具有良好的距离。我们可以通过这种方法拥有数百个区域，如果我们通过添加更多区域服务器来扩展生产集群，我们仍然会在每个服务器中拥有多个区域并支持高并发性。

![](img/00011.jpeg) 注意：您需要平衡并发性与扫描性能的性能考虑因素。每秒支持数千个并发写入的行键设计适用于事件流，但如果它不能让您有效地为您的场景读取数据，则它不是正确的选择。