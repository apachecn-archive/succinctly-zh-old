## 柱族

正如我们将在第 9 章“区域服务器内部”中看到的那样，区域内的列族是 HBase 中的物理存储单元。一个区域中一个区域的所有列都存储在同一个文件中，因此通常是列同时访问的应该位于同一列族中。

列族可以包含大量列，但是像区域一样，存在许多列族的开销。通常，每个表都有一个列系列，而官方 HBase 文档建议不超过三个系列。

如果数据具有不同的访问模式，则可以向表中添加多个列族，例如第 1 章中的社交用法表，其中包含用于 Facebook 和 Twitter 的独立系列。

在原始示例中，我包含了额外的列系列，以帮助说明如何在 HBase 中构建表，但在实际系统中，我会合理化设计，删除标识符和总计的列族，并将这些数据存储为其他族中的列。

修改后的设计只有两个列族， fb 和 tw ，整合了所有数据：

fb = Facebook，用户的 Facebook 详细信息和活动

fb：id =用户 ID

fb：t =总使用量

fb：{period} =该期间内的使用情况

tw = Twitter，用户的 Twitter 细节和活动

tw：id =用户 ID

tw：t =总使用量

tw：{期间} =该期间内的使用情况

如果我们希望为每个社交网络捕获相似数量的数据，那么这种设计将是合适的。但是如果使用率严重偏差，我们可能会遇到区域内列族的拆分问题。

如果我们的表增长到 1 亿行并且我们运行的是一个大型集群，我们可能会决定将其拆分为 1,000 个区域。这将为 Facebook 列系列提供 1,000 个数据文件，为 Twitter 提供 1,000 个数据文件（这不完全正确，但我们将在第 9 章中解压缩该声明）。

在这些 1 亿行中，如果只有一百万行包含任何 Twitter 数据，那么当我们查询 Twitter 数据时，我们的区域拆分将对性能产生负面影响。如果我们对 Twitter 行进行大扫描，则可能需要读取所有 1,000 个区域。

对于一百万行，我们可能只发现 100 个区域的最佳性能，因此通过在表中使用多个列族，我们已经损害了人口较少的系列的性能。在这种情况下，更好的设计将是两个表， facebook-usage 和 twitter-usage ，每个表都有一个列族，因此它们可以独立调整。

![](img/00010.jpeg)提示。设计具有单列族的表，除非您知道数据将具有单独的访问要求但具有相似的基数。如果大多数行在每个列族中都有数据，则具有两列或三列族的表最有效。