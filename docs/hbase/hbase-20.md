## 区域分裂和预分裂

随着数据量的增加，HBase 运行自己的管理作业以维持或提高性能，并且该管理的一部分是将大表拆分为区域。从技术上讲，您可以将其留给 HBase 自动为表创建区域，但您也可以在创建表时自行创建。

使用我们在第 2 章中使用的简单 create 语句，我们的表是使用单个区域创建的，并且它们不会被拆分，直到它们超出区域的配置大小并且 HBase 将它们分成两部分。最大大小会有所不同，但通常是 128MB 的倍数，这通常太大了 - 在拆分发生时你已经失去了很多性能，因此最好预分割你的表。

预分割意味着您在 create 语句中告诉 HBase，表应该以多少个区域开头，以及每个区域中行键的上边界。如果您可以定义边界，那么这种方法最有效，这意味着每个区域的大小应该大致相同。

这并不像听起来那么难。通用唯一 ID（UUID）或部分 UUIDS 是行键（或行键的第一部分）的不错选择。使用十六进制表示，您可以拆分第一个字符，并且表中有 16 个区域。代码清单 18 显示了 create 命令，其中 SPLITS 属性定义了区域的边界：

代码清单 18：创建具有预分割区域的表

```
create 'access-logs', 't', {SPLITS => ['1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f']}

```

HBase 负载均衡器可以很好地扩展服务器区域周围的区域，因此在具有四个区域服务器的小型集群中，我们可以预期每个服务器上运行四个访问日志区域;如果我们扩展到 16 个区域服务器，我们在每个服务器上都有一个区域，我们可以期望读取和写入具有高并发性。

如果您的数据不是均匀分布在各个地区之间，那么您将获得热点 - 某些地区的数据超过其公平份额的情况，并且必须处理更多负载。 HBase 仍然为预拆分表运行管理作业，因此如果你确实有一个超大区域，那么在某些时候它会被 HBase 自动拆分。

![](img/00010.jpeg)提示。您可以创建更多区域，但每个区域都有自己的内存和磁盘分配，因此需要更多区域。一个好的经验法则是针对每个区域服务器总共约 100 个区域 - 因此您应该将更多区域分配给性能最关键的表。

如果您随机生成 UUID，则使用 UUID 可以在您的区域之间提供良好的数据分布，但如果您想要良好的分发并希望对密钥使用事务 ID，则可以对它们进行哈希以生成行密钥。

表 4 显示了如果我们从用户 ID 的 MD5 哈希构建行密钥，如何分配来自 access-logs 表的行。 MD5 提供了一种生成确定性哈希的简单方法;该算法不适用于保护数据，但是您很可能会遇到像用户 ID 这样的小输入值的冲突：

| 行键 | 部分散列的行键 | 区域 |
| 戴夫&#124; jericho &#124; 201510 | 16108 &#124; jericho &#124; 201510 | 1（键 0 到 1） |
| 埃尔顿&#124; jericho &#124; 201510 | d5fe7 &#124; jericho &#124; 201510 | 13（键 d 到 e） |
| 弗雷德&#124; jericho &#124; 201510 | 570a9 &#124; jericho &#124; 201510 | 5（键 5 到 6） |

表 4：部分散列行密钥