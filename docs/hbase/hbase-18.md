# 第 3 章 HBase 表设计

## 行密钥结构

HBase 中的表之间没有关系，并且没有索引，数据类型，默认值，计算列或您在现代 SQL 数据库甚至其他 NoSQL 数据库中获得的任何其他花哨功能。因此，HBase 中的数据建模看似简单 - 您必须使用的唯一构造是表，行和列系列。

但是，HBase 中的数据访问总是通过行键，因此构造密钥的方式会对数据库的性能和可用性产生巨大影响。在上一章的 access-logs 表中，我使用了行密钥格式 {systemID} | {userId} | {period} 。该格式意味着该表适用于一个读取方案，但对其他方案则不利。

如果我通常在特定系统和用户的上下文中读取该表，则行键格式很好。要获取用户的访问日志，我可以使用包含排除所有其他用户和系统的边界的扫描，我会得到非常快速的响应。即使表具有数亿行，但返回几百行的扫描也需要几秒钟才能运行。

但是，如果我想找到任何在特定日上使用的所有系统，则此行键结构不是最佳的。因为句点在键的末尾，所以我无法为扫描设置边界，我需要读取每一行。拥有数亿行，可能需要数小时。如果我想使用该表，那么 {period} | {systemID} | {userID} 的行键结构会更好。

这个替代结构有其自身的问题，我们很快就会看到。它还意味着按周期查询速度很快，但如果我想为一个系统找到一个用户的访问日志，那么我将再次阅读每一行。

![](img/00010.jpeg)提示：设计行键的唯一“正确”方法是知道如何访问表，并在密钥结构中对访问进行建模。通常，您需要妥协二级读取方案，以支持主要方案。