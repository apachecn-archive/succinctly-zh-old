# 第 1 章介绍

本章将介绍有关 F# 和函数式编程（FP）的一些主要问题。

## 什么是功能编程？

纯函数式编程将所有程序视为接受参数和返回值的函数集合。与命令式和面向对象编程不同，它不允许副作用，并使用递归而不是循环来进行迭代。功能程序中的函数非常类似于数学函数，因为它们不会改变程序的状态。简单来说，一旦将值分配给标识符，它就永远不会改变，函数不会改变参数值，函数返回的结果是全新的值。在典型的底层实现中，一旦将值分配给存储器中的区域，它就不会改变。要创建结果，函数会复制值，然后更改副本，使原始值可供其他函数使用，最终在不再需要时被丢弃。 （这就是垃圾收集的概念所在。）

纯函数式编程的数学基础是优雅的，因此 FP 为许多计算问题提供了美观，简洁的解决方案，但其无状态和递归性质使得其他范例便于处理许多常见的编程任务。然而，F# 的一大优势在于你可以使用多种范例并将它们混合起来，以你最方便的方式解决问题。

## 为什么功能编程很重要？

当人们想到函数式编程时，他们经常将其无状态视为一个致命的缺陷而不考虑其优势。有人可能会争辩说，由于命令式程序通常是 90％的分配，而功能性程序没有分配，因此功能性程序可以缩短 90％。然而，正如 John Hughes 在他的经典论文“为什么功能编程很重要”中所指出的那样，没有多少人被这样的论点所信服或被吸引到无国籍递归编程的禁欲世界。

功能性程序员听起来更像是一个中世纪的僧侣，否认自己的生活乐趣，希望它能使他变得善良。

查尔姆斯理工大学 John Hughes
（ [http://www.cse.chalmers.se/~rjmh/Papers/whyfp.html](http://www.cse.chalmers.se/~rjmh/Papers/whyfp.html) ）

要了解函数式编程的优点，您必须查看 FP 允许的内容而不是它禁止的内容。例如，函数式编程允许您将函数本身视为值并将它们传递给其他函数。乍一看这看起来似乎并不那么重要，但它的影响是非凡的。消除数据和功能之间的区别意味着可以更自然地解决许多问题。与相应的命令式和面向对象的程序相比，功能程序可以更短，更模块化。

除了将函数视为值之外，函数式语言还提供了借用数学的其他特性，并且在命令式语言中并不常见。例如，函数式编程语言通常提供 _curried 函数 _，其中参数可以一次传递给一个函数，如果没有给出所有参数，则结果是剩余函数等待其余的函数参数。功能语言通常也能为类型系统提供更好的功率重量比，从而以更少的工作量提供更高的性能和正确性。

## F# 是什么？

函数式编程是解决许多棘手计算问题的最佳方法，但纯 FP 通常不适用于通用编程。正因为如此，FP 语言逐渐接受了命令式和 OO 范式的各个方面，仍然忠实于 FP 范例，但结合了轻松编写任何类型程序所需的功能。 F# 是这条道路上的自然继承者。它不仅仅是一种 FP 语言。

一些最流行的函数语言，包括 OCaml，Haskell，Lisp 和 Scheme，传统上使用自定义运行时实现，这导致诸如缺乏互操作性之类的问题。 F# 是.NET 的通用编程语言，是一种通用运行时。 F# 顺利地集成了所有三种主要的编程范例。使用 F# ，您可以选择最有效的范例，以最有效的方式解决问题。如果您是纯粹主义者，您可以进行纯函数式编程，但您可以轻松地将功能，命令式和面向对象的样式组合到同一个程序中，并利用每个范例的优势。与其他类型化的函数语言一样，F# 是强类型的，但也使用推断类型，因此程序员不需要花时间明确指定类型，除非存在歧义。此外，F# 与.NET Framework 基类库（BCL）无缝集成。在 F# 中使用 BCL 就像在 C# 或 Visual Basic 中使用它一样简单（甚至可能更简单）。

F# 以 Objective Caml（OCaml）为模型，这是一种成功的面向对象的函数式编程语言，然后通过.NET 进行调整和扩展，以便在技术和哲学上进行良好的网格划分。它完全包含.NET，使用户能够完成.NET 允许的所有操作。 F# 编译器可以编译公共语言基础结构（CLI）的所有实现，它支持.NET 泛型而无需更改任何代码，甚至还提供内联中间语言（IL）代码。 F# 编译器不仅可以为任何 CLI 生成可执行文件，还可以在任何具有 CLI 的环境中运行，这意味着 F# 不仅限于 Windows，而且可以在 Linux，Apple 的 OS X 和 iOS 以及 Google 的 Android OS 上运行。

F# 2.0 编译器随 Visual Studio 2012，Visual Studio 2010 一起发布，可作为 Visual Studio 2008 的插件使用。它支持 IntelliSense 表达式完成和自动表达式检查。它还提供工具提示，以显示已为表达式推断的类型。程序员经常评论说这确实有助于将语言变为现实。 F# 2.0 还有一个开源版本，根据 Apache 许可证授权，可从 [http://github.com/fsharp](http://github.com/fsharp) 获得。

F# 由 Don Syme 在剑桥的微软研究院（MSR）实施。该项目现已被华盛顿州雷蒙德市的微软公司所接受，现在由位于剑桥和雷德蒙德的团队开发了编译器和 Visual Studio 集成的实现。在撰写本文时，该团队专注于实现 F# 3.0，它可以在 Visual Studio“dev11”测试版中找到。

虽然其他 FP 语言在.NET 上运行，但由于其实现的质量以及与.NET 和 Visual Studio 的卓越集成，F# 已经将自己确立为事实上的.NET 函数编程语言。

没有其他.NET 语言像 F# 一样易于使用和灵活！

## 谁在使用 F# ？

F# 在微软内部以及整个公司的整个公司都有强大的影响力。专注于机器学习技术的 MSR 应用游戏集团的领导者拉尔夫·赫布里希（Ralf Herbrich）是 F# 越来越多粉丝的典型代表：

第一个应用程序解析了超过 300 个目录中的 11,000 个文本文件的 110GB 日志数据，并将其导入 SQL 数据库。整个应用程序长达 90 行（包括注释！），完成了解析源文件并在 18 小时内导入数据的任务;这可以达到每秒处理的惊人的 10,000 个日志行！请注意，我还没有优化代码，只是以最明显的方式编写应用程序。我真的很惊讶，因为我已经计划了至少一周的编写和运行应用程序的工作。

第二个应用是对数百万反馈的分析。我们开发了模型方程式，我只是将它们作为 F# 程序输入;结合读取数据从 SQL 数据库和写入结果到 MATLAB 数据文件，F# 源代码长达 100 行（包括注释）。再次，我对运行时间感到惊讶;数百万个数据项的整个处理在标准台式机上需要 10 分钟。我的 C# 参考应用程序（来自一些早期的任务）差不多有 1000 行，而且速度不快。从开发模型方程到拥有第一个真实世界数据结果的整个工作耗时 2 天。

Ralf Herbrich，微软研究院
（ [http://blogs.msdn.com/dsyme/archive/2006/04/01/566301.aspx](http://blogs.msdn.com/dsyme/archive/2006/04/01/566301.aspx) ）

微软以外的 F# 使用量也在快速增长。我问过 Cyfeon Solutions 的首席技术官 Chance Coble 关于 F# 为他的工作带来了什么。

F# 一遍又一遍地向我提起诉讼。我决定尝试 F# 的第一个项目是机器视觉努力，它将从提交的指纹卡中识别和提取指纹并将其加载到生物识别系统中。项目计划是手动执行指纹提取，这种方法越来越繁琐，自动化成为一个巨大的胜利（代码非常少）。后来我们决定将 F# 工作包含在一个用 C# 编写的更大的应用程序中，并轻松完成集成。从那时起，我在机器学习，特定领域语言设计，三维可视化，符号分析以及任何需要性能密集型数据处理的项目中使用了 F# 。能够轻松地将功能模块集成到现有的生产规模应用程序中，使 F# 不仅有趣，而且是项目负责人的重要补充。使用像.NET 这样成熟而丰富的平台来统一函数式编程已经开启了大量的机会。

Chafe Coble，Cyfeon Solutions 首席技术官（私人电子邮件）

## 这本书给谁？

本书主要面向希望快速掌握 F# 的 IT 专业人员。 .NET Framework 的工作知识以及 C# 或 Visual Basic 的一些知识会很好，但这不是必需的。您真正需要的是一些使用任何语言编程的经验，以便学习 F# 。

即使是以前从未编程并且正在学习 F# 作为他们的第一个计算机语言的完整初学者应该会发现这本书非常易读。虽然它本身并不试图教授入门编程，但它确实提供了 F# 的所有重要细节。